\chapter{Разработка стенда для проведения лабораторных работ}
Для разработки и выполнения лабораторных работ по курсу <<Языки описания аппаратного обеспечения>> необходим, специальным образом настроенный, программно-аппаратный комплекс (стенд), включающий в себя персональный компьютер с установленным программным обеспечением и подключенная и настроенная отладочная плата.
\section{Необходимое программное обеспечение}
Для разработки программ под микроконтроллеры семейства ARM на компьютере должна быть установлена среда разработки. Существует несколько сред разработки, имеющих в своем составе полный комплекс средств для разработки программного обеспечения под микроконтроллеры. В настоящее время наиболее популярны \textit{IAR Embedded Workbench} от компании IAR Systems, \textit{Keil} от Keil Software, свободная интегрированная среда разработки модульных кроссплатформенных приложений \textit{Eclipse}, разрабатываемая Eclipse Foundation. Также существует большое количество сред разработки под микроконтроллеры семейства ARM от других производителей, однако, их популярность и, как следствие, количество доступной справочной информации значительно ниже.



\section{Установка программного обеспечения}
Использование персонального компьютера в составе лабораторного стенда требует установки соответствующего программного обеспечения. Используемое в разработке программное обеспечение требует наличие операционной системы Windows XP и более поздних версий, установка в операционной системе Linux не предусматривается.

Для лабораторного стенда на базе отладочной платы STM32L  - Discovery по курсу ЯОАО необходима установка следующего программного обеспечения:
\begin{itemize}
\item IAR Embedded Workbench for ARM, версия 6.21 и более поздние версии
\item Драйвер ST-LINK\_V2\_USBdriver программатора ST-LINK
\item Набор библиотек \textit{STM32L1 Discovery firmware package }(RN0079), доступный на официальном сайте STMicroelectronics
\end{itemize}
Установка IAR Embedded Workbench for ARM происходит стандартными средствами Windows, установка драйвера ST-LINK\_V2\_USBdriver в ОС Windows 8, Windows 8.1 имеет трудности из-за отсутствия у данного драйвера цифровой подписи (в процессе установки данного драйвера появляется сообщение: \textit{INF стороннего производителя не содержит информации о подписи}).

\subsection{Установка драйвера ST-LINK\_V2\_USBdriver}
Для установки драйвера ST-LINK\_V2\_USBdriver необходимо проделать следующие шаги:
\begin{enumerate}
\item Подключить отладочную плату STM32L - Discovery.
\item Установить драйвер ST-LINK\_V2\_USBdriver.
\item В диспетчере устройств, у устройства от STmicroelectronics, в контекстном меню выбрать пункт <<Обновить двайверы...>>, в появившемся окне согласиться использовать драйвер стороннего производителя.
\end{enumerate}


Для установки драйвера ST-LINK\_V2\_USBdriver в операционных системах Windows 8, Windows 8.1 необходимо отключить проверку цифровой подписи драйверов при запуске системы, для  этого необходимо:
\begin{enumerate}
\item Войти в панель настроек (Settings Panel)
\item В нижнем углу панели настроек выбрать пункт <<Изменение параметров компьютера>>, в появившемся меню слева, в разделе <<Общие>> в пункте <<Особые варианты загрузки>> нажать <<Перезагрузить сейчас>>
\begin{figure}[H]
\begin{center}
\includegraphics[scale=0.45]{Image/106.jpg} 
\end{center}
\caption{Изменение параметров компьютера}
\end{figure}
\item В появившимся окне выбрать пункт <<Диагностика>>, затем <<Дополнительные параметры>>, затем <<Параметры загрузки>>
\item При перезагрузке компьютера, во время загрузки операционной системы, на экране будут отображены различные варианты загрузки. Необходимо выбрать пункт <<Отключить обязательную проверку подписи драйвера>>, нажав \textit{F7}
\item После старта операционной системы в диспетчере устройств, необходимо обновить драйвер устройства \textit{STLink doungle}. 

\begin{figure}[H]
\begin{center}
\includegraphics[scale=1]{Image/108.jpg} 
\end{center}
\caption{Обновление драйвера устройства \textit{STLink doungle}}
\end{figure}
\item Во время обновления драйвера появиться окно Windows Security, указывающее на то, что драйвер не имеет цифровой подписи. В окне нужно выбрать пункт <<Install this driver anyway>>
\begin{figure}[H]
\begin{center}
\includegraphics[scale=0.8]{Image/107.jpg} 
\end{center}
\caption{Установка драйвера без цифровой подписи}
\end{figure}
\end{enumerate}

\section{Конструкция стенда}
Аппаратная часть стенда для проведения лабораторных работ по курсу ЯОАО представляет собой программатор - отладчик ST-LINK V2, микроконтроллер STM32L152RB, установленный на отладочной плате с набором периферии (2 светодиода, сенсорная панель, жидкокристаллический индикатор) и подключенный к отладочной плате компьютер. Структурная схема стенда приведена на рисунке \ref{shemstend}, стуктурная схема стенда отладочной платы приведена на рисунке \ref{shemaplata}.

\begin{figure}[H]
\begin{center}
\includegraphics[scale=0.5]{Image/99.jpg} 
\end{center}
\caption{Структурная схема стенда}\label{shemstend}
\end{figure}

\begin{figure}[H]
\begin{center}
\includegraphics[scale=0.4]{Image/109.jpg} 
\end{center}
\caption{Структурная схема отладочной платы STM32L - Discovery}\label{shemaplata}
\end{figure}

\begin{figure}[H]
\begin{center}
\includegraphics[scale=0.5]{Image/110.jpg} 
\end{center}
\caption{Какая-то схема отладочной платы}
\end{figure}

В состав микроконтроллера STM32L152RB входят 6 портов ввода-вывода общего назначения, позволяющего подключать и управлять периферией, контроллер ЖКИ, контроллер DMA, АЦП, ЦАП, контроллер прерываний, таймеры, контроллеры UART, I2C. Функциональная схема микроконтроллера STM32L152RB приведена на рисунке \ref{funckmicrocont}.

На отладочной плате STM32L - Discovery доступна пользовательская кнопка USER, подключенная к порту PA0 микроконтроллера STM32L152RB. Принципиальная схема подключения кнопки приведена на рисунке \ref{buttonsheme}.
\begin{figure}[H]
\begin{center}
\includegraphics[scale=0.31]{Image/100.jpg} 
\end{center}
\caption{Функциональная схема микроконтроллера STM32L152RB}\label{funckmicrocont}
\end{figure}


\begin{figure}[H]
\begin{center}
\includegraphics[scale=0.5]{Image/101.jpg} 
\end{center}
\caption{Принципиальная схема подключения сенсорной панели}
\end{figure}
 

\begin{figure}[H]
\begin{center}
\includegraphics[scale=0.6]{Image/102.jpg} 
\end{center}
\caption{Принципиальная схема подключения пользовательской кнопки \textit{USER}}\label{buttonsheme}
\end{figure}


\begin{figure}[H]
\begin{center}
\includegraphics[scale=0.35, angle=90]{Image/103.jpg} 
\end{center}
\caption{Принципиальная схема подключения микроконтроллера STM32L152RB}
\end{figure}
На отладочной плате STM32L - Discovery установлен внутрисхемный программатор \textit{ST-LINK}, который используется для программирования микроконтроллера STM32L1RB, установленного на отладочной плате. ST-LINK может использоваться для отладки и программирования микроконтроллеров серии STM8 и STM32, что позволяет использовать отладочную плату STM32L - Discovery в качестве аппаратного программатора для других плат и микроконтроллеров семейства STM. Программатор построен микроконтроллере STM32F103C8T6. Принципиальная схема приведена на рисунке \ref{stmf103}.

\begin{figure}[H]
\begin{center}
\includegraphics[scale=0.5]{Image/104.jpg} 
\end{center}
\caption{Принципиальная схема программатора \textit{ST-LINK}}\label{stmf103}
\end{figure}

Для загрузки программы в микроконтроллер используется \textit{SWD} интерфейс. \textit{Serial Wire Debug} (SWD) --- новый 2-pin интерфейс для микроконтроллеров на базе Cortex-M3, который заменяет стандартный интерфейс \textit{JTAG}, предлагая дополнительно к его возможностям доступ к памяти в реальном времени без останова процессора и какого-либо резидентного кода.  \textit{Serial Wire Viewer}  использует еще один дополнительный контакт и позволяет просматривать значения переменных и сообщения об отладке при работающем на полной скорости микроконтроллере. Принципиальная схема SWD порта отладочной платы STM32L - Discovery приведена на рисунке \ref{SWD}.
\begin{figure}[H]
\begin{center}
\includegraphics[scale=0.55]{Image/105.jpg} 
\end{center}
\caption{Принципиальная схема \textit{SWD} интерфейса} \label{SWD}
\end{figure}